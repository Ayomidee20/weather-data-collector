# Import the Active Directory module
Import-Module ActiveDirectory

# Get a list of all OUs in the domain
$ous = Get-ADOrganizationalUnit -Filter * -Properties Name

# Define the output file path in the Downloads folder
$outputFile = "$([Environment]::GetFolderPath('UserProfile'))\Downloads\ActiveADUsersList.txt"

# Clear the output file if it exists, or create a new one
New-Item -ItemType File -Path $outputFile -Force | Out-Null

# Iterate through each OU
foreach ($ou in $ous) {
    # Append the OU name to the file
    Add-Content -Path $outputFile -Value "OU Name: $($ou.Name)"
    
    # Get a list of active users in the OU
    $users = Get-ADUser -Filter {Enabled -eq $true} -SearchBase $ou.DistinguishedName
    
    # Check if there are users in the OU
    if ($users) {
        foreach ($user in $users) {
            # Append the user's name to the file
            Add-Content -Path $outputFile -Value "    User: $($user.Name)"
        }
    } else {
        # Indicate no active users found in the OU
        Add-Content -Path $outputFile -Value "    No active users found."
    }
    
    # Add a blank line to separate OUs
    Add-Content -Path $outputFile -Value ""
}

# Notify the user that the file is saved
Write-Host "The active user list has been saved to: $outputFile"
